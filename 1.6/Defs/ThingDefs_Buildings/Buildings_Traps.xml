<?xml version="1.0" encoding="utf-8" ?>
<Defs>
  <ThingDef ParentName="BuildingBase">
    <defName>VFES_BearTrap</defName>
    <label>bear trap</label>
    <description>Two heavy metal jaws held open under tension, connected to a pressure-sensitive trigger. When stepped on, the jaws snap shut with high force, inflicting severe damage. Since it is hidden in the surrounding terrain, it cannot be placed adjacent to other traps. When triggered, it can be re-armed.</description>
    <thingClass>VFESecurity.Building_TrapBear</thingClass>
    <graphicData>
      <texPath>NewThings/Security/TrapBear/TrapBearArmed</texPath>
      <graphicClass>Graphic_Single</graphicClass>
      <damageData>
        <rect>(0,0,1,0.15)</rect>
      </damageData>
    </graphicData>
    <techLevel>Medieval</techLevel>
    <altitudeLayer>Building</altitudeLayer>
    <drawerType>RealtimeOnly</drawerType>
    <rotatable>false</rotatable>
    <tickerType>Normal</tickerType>
    <stealable>false</stealable>
    <minifiedDef>MinifiedThing</minifiedDef>
    <thingCategories>
      <li>BuildingsSecurity</li>
    </thingCategories>
    <comps>
      <li Class="VFESecurity.CompProperties_Rearmable">
        <initiallyArmed>true</initiallyArmed>
        <unarmedGraphicData>
          <texPath>NewThings/Security/TrapBear/TrapBearTripped</texPath>
          <graphicClass>Graphic_Single</graphicClass>
          <shaderType>Cutout</shaderType>
        </unarmedGraphicData>
        <workToRearm>600</workToRearm>
        <rearmSound>TrapArm</rearmSound>
      </li>
    </comps>
    <statBases>
      <Mass>3.0</Mass>
      <MaxHitPoints>40</MaxHitPoints>
      <WorkToBuild>4000</WorkToBuild>
      <Flammability>1</Flammability>
      <Beauty>-18</Beauty>
      <Cleanliness>-5</Cleanliness>
      <TrapMeleeDamage>35</TrapMeleeDamage>
      <TrapSpringChance>1.0</TrapSpringChance>
    </statBases>
    <stuffCategories>
      <li>Metallic</li>
    </stuffCategories>
    <costStuffCount>65</costStuffCount>
    <designationCategory>Security</designationCategory>
    <building>
      <isTrap>true</isTrap>
      <trapDestroyOnSpring>false</trapDestroyOnSpring>
      <trapDamageCategory>Sharp</trapDamageCategory>
      <expandHomeArea>false</expandHomeArea>
      <ai_chillDestination>false</ai_chillDestination>
    </building>
    <constructionSkillPrerequisite>4</constructionSkillPrerequisite>
    <researchPrerequisites>
      <li>ComplexFurniture</li>
    </researchPrerequisites>
    <placeWorkers>
      <li>PlaceWorker_NeverAdjacentTrap</li>
    </placeWorkers>
  </ThingDef>

  <!-- Cavalry Spikes -->
  <ThingDef ParentName="BuildingBase">
    <defName>VFES_CavalrySpikes</defName>
    <label>cavalry spikes</label>
    <description>A row of sharpened spikes laid low across the ground. Designed to maim or cripple those who attempt to charge through, especially fast-moving animals or mounted units. Can be placed next to other cavalry spikes. Upon being triggered, cavalry spikes will need to be rebuilt.</description>
    <thingClass>Building_TrapDamager</thingClass>
    <graphicData>
      <texPath>NewThings/Security/CavalrySpikes</texPath>
      <graphicClass>Graphic_Multi</graphicClass>
      <drawSize>(3,2)</drawSize>
      <damageData>
        <rect>(0,0,1,0.15)</rect>
      </damageData>
    </graphicData>
    <size>(2,1)</size>
    <!--    <uiIconPath>NewThings/Security/CavalrySpikes_south</uiIconPath>-->
    <altitudeLayer>Building</altitudeLayer>
    <tickerType>Normal</tickerType>
    <category>Building</category>
    <stealable>false</stealable>
    <minifiedDef>MinifiedThing</minifiedDef>
    <!--    <uiOrder>30</uiOrder>-->
    <thingCategories>
      <li>BuildingsSecurity</li>
    </thingCategories>
    <costList>
      <WoodLog>75</WoodLog>
    </costList>
    <statBases>
      <Mass>3.0</Mass>
      <Beauty>-10</Beauty>
      <Cleanliness>-5</Cleanliness>
      <MaxHitPoints>40</MaxHitPoints>
      <Flammability>1.0</Flammability>
      <WorkToBuild>5450</WorkToBuild>
      <!-- Not stuffable, so compensate the damage to what damage from a normal wooden spike trap would be. -->
      <TrapMeleeDamage>40</TrapMeleeDamage>
      <TrapSpringChance>1</TrapSpringChance>
      <VFES_TrapMeleeHits>6</VFES_TrapMeleeHits>
    </statBases>
    <designationCategory>Security</designationCategory>
    <building>
      <isTrap>true</isTrap>
      <trapDestroyOnSpring>true</trapDestroyOnSpring>
      <trapDamageCategory>Sharp</trapDamageCategory>
      <expandHomeArea>false</expandHomeArea>
      <ai_chillDestination>false</ai_chillDestination>
    </building>
    <constructionSkillPrerequisite>3</constructionSkillPrerequisite>
    <researchPrerequisites>
      <li>VFES_SiegeEquipment</li>
    </researchPrerequisites>
    <rotatable>true</rotatable>
    <pathCost>10</pathCost>
    <passability>PassThroughOnly</passability>
    <constructEffect>ConstructWood</constructEffect>
    <repairEffect>ConstructWood</repairEffect>
    <terrainAffordanceNeeded>Light</terrainAffordanceNeeded>
  </ThingDef>

  <ThingDef ParentName="TrapIEDBase">
    <defName>VEFS_TrapLandmine</defName>
    <label>landmine</label>
    <description>A sophisticated explosive charge connected to a pressure plate trigger which detonates immediately on touch. Since it is hidden in the surrounding terrain, it cannot be placed adjacent to other traps. Animals can sense these when calm.</description>
    <graphicData>
      <texPath>NewThings/Security/Landmine</texPath>
    </graphicData>
    <statBases>
      <Mass>2</Mass>
      <MaxHitPoints>50</MaxHitPoints>
      <WorkToBuild>2000</WorkToBuild>
      <Flammability>1</Flammability>
      <Beauty>-4</Beauty>
      <TrapSpringChance>1.0</TrapSpringChance>
    </statBases>
    <costList>
      <Shell_HighExplosive>2</Shell_HighExplosive>
      <ComponentIndustrial>1</ComponentIndustrial>
    </costList>
    <comps>
      <li Class="CompProperties_Explosive">
        <explosiveRadius>5.9</explosiveRadius>
        <explosiveDamageType>Bomb</explosiveDamageType>
        <startWickHitPointsPercent>0.2</startWickHitPointsPercent>
        <preExplosionSpawnSingleThingDef>Filth_BlastMark</preExplosionSpawnSingleThingDef>
        <wickTicks>0</wickTicks>
        <startWickOnDamageTaken>
          <li>Bullet</li>
          <li>Arrow</li>
          <li>ArrowHighVelocity</li>
        </startWickOnDamageTaken>
      </li>
    </comps>
    <!-- Vanilla IEDs go from 40 to 46, and the next thing is at 2999 (default). Use 50 in case vanilla ever adds more, but try to be before anything else. -->
    <uiOrder>50</uiOrder>
    <specialDisplayRadius>5.9</specialDisplayRadius>
    <constructionSkillPrerequisite>5</constructionSkillPrerequisite>
  </ThingDef>

  <ThingDef ParentName="TrapIEDBase">
    <defName>VEFS_TrapShockmine</defName>
    <label>shockmine</label>
    <description>A concealed high-tech trap that releases a localized EMP pulse when triggered. It resets automatically after a short cooldown. Since it is hidden in the surrounding terrain, it cannot be placed adjacent to other traps. Animals can sense these when calm.</description>
    <thingClass>VFESecurity.Building_TrapExplosive_SelfStun</thingClass>
    <graphicData>
      <texPath>NewThings/Security/Shockmine</texPath>
    </graphicData>
    <statBases>
      <Mass>2.5</Mass>
      <MaxHitPoints>50</MaxHitPoints>
      <WorkToBuild>2500</WorkToBuild>
      <Flammability>1</Flammability>
      <Beauty>-2</Beauty>
      <TrapSpringChance>1.0</TrapSpringChance>
    </statBases>
    <costList>
      <ComponentIndustrial>1</ComponentIndustrial>
      <ComponentSpacer>1</ComponentSpacer>
    </costList>
    <comps>
      <li Class="VFESecurity.CompProperties_ExplosiveExtraDamage">
        <!-- CompProperties_ExplosiveExtraDamage uses the same comp as CompProperties_Explosive, but supports a few extra values. -->
        <explosiveDamageType>EMP</explosiveDamageType>

        <!-- Extra damage/explosion stats. Supports its own armor penetration, chance to start fire, and damage falloff. -->
        <!-- All use the same names as normal explosive properties for the same things, but first letter capitalized and prepended with "extra". -->
        <extraExplosiveDamageType>Burn</extraExplosiveDamageType>
        <extraDamageAmountBase>5</extraDamageAmountBase>

        <explosiveRadius>4.5</explosiveRadius>
        <wickTicks>0</wickTicks>
        <startWickOnDamageTaken>
          <li>Bullet</li>
          <li>Arrow</li>
          <li>ArrowHighVelocity</li>
        </startWickOnDamageTaken>
        <!-- Don't destroy when exploded by only destroying on impossibly high explosion size. Could probablye just slap "PositiveInfinity" here? -->
        <destroyThingOnExplosionSize>1000000</destroyThingOnExplosionSize>
      </li>
      <!-- CompProperties_StunnableCodeTrigger - same as CompProperties_Stunnable, but doesn't report config errors for no damage defs. -->
      <li Class="VFESecurity.CompProperties_StunnableCodeTrigger">
        <!-- Exactly same as CompStunnable, but with inspect string themed as cooldown. -->
        <!-- Neither the CompProps nor the compClass rely on one another. You can use basic CompStunnable, or CompProperties_Stunnable instead, and it'll work fine. -->
        <compClass>VFESecurity.CompStunnableAsCooldown</compClass>
      </li>
    </comps>
    <!-- Vanilla IEDs go from 40 to 46, and the next thing is at 2999 (default). Use 50 in case vanilla ever adds more, but try to be before anything else. -->
    <uiOrder>50</uiOrder>
    <specialDisplayRadius>4.5</specialDisplayRadius>
    <constructionSkillPrerequisite>5</constructionSkillPrerequisite>
    <modExtensions>
      <!-- Used by Building_TrapExplosive_SelfStun when applying the self stun. -->
      <!-- Since the building relies on this, but not the custom CompProps, they are separate. -->
      <li Class="VFESecurity.SelfStunTrapExtension">
        <!-- Stun duration -->
        <stunTicks>10000</stunTicks>
        <!-- If the "Stunned" text mode should appear -->
        <showMote>false</showMote>
      </li>
    </modExtensions>
  </ThingDef>

</Defs>